<!DOCTYPE HTML>
<!--
	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.
	
	You should have received a copy of the GNU General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.

    Based in part on JSSpeccy:	
	Contact details: <matthew@west.co.tt>
	Matthew Westcott, 14 Daisy Hill Drive, Adlington, Chorley, Lancs PR6 9NE UNITED KINGDOM
-->
<html>
	<head>
		<title>Miracle</title>
		<link rel="stylesheet" href="miracle.css" type="text/css">
		<script type="text/javascript" src="z80/z80_full.js"></script>
		<script type="text/javascript" src="z80/z80_ops_full.js"></script>
		<script type="text/javascript" src="miracle.js"></script>
		<script type="text/javascript" src="roms.js"></script>
		<script type="text/javascript">/* <![CDATA[ */
			var tstates = 0;
			var running;
			var event_next_event;
			function addRomToList(rom) {
				var li = document.createElement('li');
				var a = document.createElement('a');
				a.appendChild(document.createTextNode(rom));
				li.appendChild(a);
				a.href = 'javascript:void(0)';
				a.onclick = function() {
					loadRom(roms[rom]);
					hideRomChooser();
					start();
				}
				document.getElementById('rom_list').appendChild(li);
			}
			function go() {
				hideRomChooser();
				hideAbout();
				for (rom in roms) {
					addRomToList(rom);
				}
				
				z80_init();
				miracle_init();
				loadRom(roms['TeddyBoy.sms']);
				start();
			}
			function frame() {
				event_next_event = 69888;
				tstates = 0;
				z80_do_opcodes();
				/* dumpScreen(); */
				paintScreen();
				z80_interrupt();
			}
			function dumpScreen() {
				var out = '';
				for (var i = 0x0000; i < 0x4000; i++) {
					out += Number(vram[i]).toString(16) + ' ';
				}
				document.getElementById('screendump').value = out;
			}
			function start() {
				if (running) return;
				running = true;
				document.getElementById('menu').className = 'running';
				run();
			}
			function run() {
				if (!running) return;
				frame();
				setTimeout(run, 20);
			}
			function stop() {
				document.getElementById('menu').className = 'stopped';
				running = false;
			}
			function reset() {
				z80_reset();
			}
			function showRomChooser() {
				document.getElementById('rom_chooser').style.display = 'block';
			}
			function hideRomChooser() {
				document.getElementById('rom_chooser').style.display = 'none';
			}
			function showAbout() {
				document.getElementById('about').style.display = 'block';
			}
			function hideAbout() {
				document.getElementById('about').style.display = 'none';
			}
		/* ]]> */</script>
	</head>
	<body onload="go()">
		<canvas id="screen" width="256" height="192"></canvas>
		<ul id="menu" class="stopped">
			<li id="menu_run"><a href="javascript:void(0)" onclick="start()" title="Play">Play</a></li>
			<li id="menu_stop"><a href="javascript:void(0)" onclick="stop()" title="Pause">Pause</a></li>
			<li id="menu_reset"><a href="javascript:void(0)" onclick="reset()" title="Reset">Reset</a></li>
			<li id="menu_open"><a href="javascript:void(0)" onclick="showRomChooser()" title="Open ROM">Open ROM</a></li>
			<li id="menu_about"><a href="javascript:void(0)" onclick="showAbout()" title="About JSSpeccy">About JSSpeccy</a></li>
		</ul>
		<!-- <textarea rows="24" cols="96" id="screendump"></textarea> -->
		<!-- <textarea id="keydump"></textarea> -->
		<br />
		<div id="rom_chooser">
			<div>Open ROM file: <input type="file" id="file_upload" /></div>
			<p>Or select a game:</p>
			<ul id="rom_list"></ul>
			<a href="javascript:void(0)" class="close_button" onclick="hideRomChooser()">Close</a>
		</div>
		<div id="about">
			<h1>JSSpeccy</h1>
			<h2>a ZX Spectrum emulator in Javascript</h2>
			<p>By <a href="http://matt.west.co.tt/">Matt Westcott</a></p>
			<p><a href="http://matt.west.co.tt/category/javascript/jsspeccy/">JSSpeccy homepage</a> (including downloads and source code)</p>
			<p>Based on <a href="http://fuse-emulator.sourceforge.net/">Fuse</a> by Philip Kendall et al. Icons from <a href="http://www.icon-king.com/projects/nuvola/">Nuvola</a> by David Vignoni.</p>
			<div id="licence">
				<p>This program is free software: you can redistribute it and/or modify
				it under the terms of the GNU General Public License as published by
				the Free Software Foundation, either version 3 of the License, or
				(at your option) any later version.</p>
				<p>This program is distributed in the hope that it will be useful,
				but WITHOUT ANY WARRANTY; without even the implied warranty of
				MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
				GNU General Public License for more details.</p>
				
				<p>You should have received a copy of the GNU General Public License
				along with this program.  If not, see &lt;<a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
			</div>

			<a href="javascript:void(0)" class="close_button" onclick="hideAbout()">Close</a>
		</div>
	</body>
</html>
